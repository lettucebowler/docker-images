version: "3.7"
services:
  express-vpn:
    container_name: express-vpn
    image: polkaned/expressvpn
    environment:
      - ACTIVATION_CODE=E6CX9SFB3PPW5QLMSHVSWXR
      - SERVER=usch
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun
    stdin_open: true
    tty: true
    command: /bin/bash
    privileged: true
    restart: unless-stopped
    ports: 
      - 58846:58846
      - 8112:8112

#  pia-vpn:
#    image: qmcgaw/gluetun
#    container_name: pia-vpn
#    cap_add:
#      - NET_ADMIN
#    ports:
#      - 8888:8888/tcp # HTTP proxy
#      - 8388:8388/tcp # Shadowsocks
#      - 8388:8388/udp # Shadowsocks
#      - 8000:8000/tcp # Built-in HTTP control server
#      - 58846:58846
#      - 8112:8112
      # - 9091:9091
      # - 51413:51413
      # - 51413:51413/udp
    # command:
#    volumes:
#      - /opt/docker/volumes/torrent/gluetun:/gluetun
#    secrets:
#      - openvpn_user
#      - openvpn_password
#    environment:
      # More variables are available, see the readme table
#      - VPNSP=private internet access
      # Timezone for accurate logs times
#      - TZ=America/Chicago
 #     - REGION=CA Ontario
#    restart: always


  deluge:
    image: ghcr.io/linuxserver/deluge
    container_name: deluge
    network_mode: service:express-vpn
    depends_on:
      - express-vpn
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
      - DELUGE_LOGLEVEL=error #optional
    volumes:
      - /opt/docker/volumes/torrent/deluge/config:/config
      - /share/Torrents:/torrents
      - /share/Downloads:/downloads
    restart: unless-stopped
  # transmission:
  #     image: ghcr.io/linuxserver/transmission
  #     container_name: transmission
  #     network_mode: service:pia-vpn
  #     depends_on:
  #       - pia-vpn
  #     environment:
  #       - PUID=1000
  #       - PGID=1000
  #       - TZ=America/Chicago
  #       # - TRANSMISSION_WEB_HOME=/combustion-release/ #optional
  #       - USER=lettucebowler #optional
  #       - PASS=rusondia13 #optional
  #       # - WHITELIST=iplist #optional
  #       # - HOST_WHITELIST=dnsnane list #optional
  #     volumes:
  #       - /opt/docker/volumes/torrent/transmission/config:/config
  #       - /share/Downloads:/downloads
  #       - /share/Torrents:/watch
  #     # ports:
  #     #   - 9091:9091
  #     #   - 51413:51413
  #     #   - 51413:51413/udp
  #     restart: unless-stopped
  proxy:
    image: ghcr.io/linuxserver/nginx
    container_name: proxy
    depends_on:
      - express-vpn
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
    volumes:
        - /opt/docker/volumes/torrent/proxy:/config
    restart: unless-stopped

networks:
  default:
    external:
      name: express

secrets:
  openvpn_user:
    file: ./openvpn_user
  openvpn_password:
    file: ./openvpn_password
